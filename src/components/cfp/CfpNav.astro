---
import SideNavItem from "../SideNavItem.astro";

// Import all cfp pages with their metadata
const pages = import.meta.glob('../../pages/cfp/*.astro', { eager: true });

// Helper to convert slug to title (e.g., "specialist-tracks" -> "Specialist Tracks")
const slugToTitle = (slug: string) =>
  slug.replace(/-/g, ' ').replace(/\b\w/g, (c) => c.toUpperCase());

// Extract nav metadata and sort by order, with fallback for pages without nav export
const navItems = Object.entries(pages)
  .filter(([path]) => !path.includes('index.astro'))
  .map(([path, mod]: [string, any]) => {
    const slug = path.match(/\/cfp\/(.+)\.astro$/)?.[1] ?? '';
    const nav = mod.nav;

    return {
      href: `/cfp/${slug}`,
      title: nav?.title ?? slugToTitle(slug),
      order: nav?.order ?? Infinity,
      tile: nav?.tile !== undefined ? nav.tile : true,
      image: nav?.image
    };
  })
  .sort((a, b) => a.order - b.order || a.title.localeCompare(b.title));
---

<div class="lg:w-[308px] w-full">
  <div class="bg-emerald rounded-[3.125rem]">
    <div class="side-nav bg-lime rounded-[3.125rem] p-8 -translate-y-5">
      <a href="/cfp/">
        <h3 class="text-intro font-semibold">Call For Proposals</h3>
      </a>
      <ul class="font-medium font-sans text-charcoal space-y-4 mt-8">
        {navItems.map((item) => (
          <SideNavItem href={item.href}>{item.title}</SideNavItem>
        ))}
      </ul>
    </div>
  </div>
</div>
